<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tambah Data Santri - DEISA</title>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css">

    <!-- Bootstrap Icons (offline) -->
    <link rel="stylesheet" href="bootstrap-icons/bootstrap-icons.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="style.css">
</head>

<body>

    <!-- NAVBAR -->
    <nav class="top-navbar">
        <h4 class="m-0">DEISA</h4>

        <div class="d-flex align-items-center gap-3">
            <span class="fw-semibold d-none d-md-inline">Admin</span>
            <button class="btn btn-danger btn-sm d-none d-md-inline">
                <i class="bi bi-box-arrow-right me-1"></i> Log Out
            </button>

            <!-- HAMBURGER -->
            <button class="btn btn-primary d-md-none" id="btn-toggle">
                <i class="bi bi-list"></i>
            </button>
        </div>
    </nav>


    <!-- SIDEBAR -->
    <nav class="sidebar" id="sidebar">
        <ul class="nav flex-column gap-2">

            <li class="nav-item">
                <a class="nav-link" href="dashboard.html">
                    <i class="bi bi-speedometer2 me-2"></i> Dashboard
                </a>
            </li>

            <li class="nav-item">
                <a class="nav-link" href="read.html">
                    <i class="bi bi-people me-2"></i> Data Santri
                </a>
            </li>

            <li class="nav-item">
                <a class="nav-link" href="#">
                    <i class="bi bi-building me-2"></i> Kelas
                </a>
            </li>

            <li class="nav-item">
                <a class="nav-link" href="#">
                    <i class="bi bi-capsule-pill me-2"></i> Obat
                </a>
            </li>

            <li class="nav-item">
                <a class="nav-link" href="#">
                    <i class="bi bi-file-earmark-text me-2"></i> Laporan
                </a>
            </li>

        </ul>
    </nav>

    <!-- CONTENT -->
    <div class="content">

        <!-- PAGE HEADER -->
        <div class="mb-4">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb mb-2">
                    <li class="breadcrumb-item">
                        <a href="dashboard.html" class="text-decoration-none">Dashboard</a>
                    </li>
                    <li class="breadcrumb-item">
                        <a href="read.html" class="text-decoration-none">Data Santri</a>
                    </li>
                    <li class="breadcrumb-item active" aria-current="page">
                        Tambah Santri
                    </li>
                </ol>
            </nav>

            <h4 class="fw-bold mb-0">Tambah Data Santri</h4>
            <small class="text-muted">
                Lengkapi data identitas santri dengan benar. Input data di sebelah kiri, kemudian lihat hasilnya di
                sebelah kanan.
            </small>
        </div>

        <!-- TWO COLUMN LAYOUT -->
        <div class="row g-4">

            <!-- LEFT SECTION - FORM INPUT -->
            <div class="col-lg-6">
                <div class="form-input-section">
                    <h5 class="fw-bold mb-4">
                        <i class="bi bi-pencil-square me-2 text-primary"></i> Form Input Data
                    </h5>

                    <form id="formSantri">

                        <!-- SANTRI SECTION -->
                        <h6 class="fw-bold text-primary mb-3">Data Santri</h6>

                        <!-- NIS -->
                        <div class="mb-3">
                            <label class="form-label fw-semibold">NIS</label>
                            <div class="input-group">
                                <span class="input-group-text">
                                    <i class="bi bi-person-badge"></i>
                                </span>
                                <input type="text" class="form-control" id="nis" placeholder="Masukkan NIS" required>
                            </div>
                        </div>

                        <!-- NAMA -->
                        <div class="mb-3">
                            <label class="form-label fw-semibold">Nama Lengkap</label>
                            <div class="input-group">
                                <span class="input-group-text">
                                    <i class="bi bi-person"></i>
                                </span>
                                <input type="text" class="form-control" id="namaSantri"
                                    placeholder="Nama lengkap santri" required>
                            </div>
                        </div>

                        <!-- JENIS KELAMIN -->
                        <div class="mb-3">
                            <label class="form-label fw-semibold">Jenis Kelamin</label>
                            <select class="form-select" id="jenisKelamin" required>
                                <option selected disabled>-- Pilih --</option>
                                <option value="Laki-laki">Laki-laki</option>
                                <option value="Perempuan">Perempuan</option>
                            </select>
                        </div>

                        <!-- KELAS -->
                        <div class="mb-3">
                            <label class="form-label fw-semibold">Kelas</label>
                            <select class="form-select" id="kelas" required>
                                <option selected disabled>-- Pilih Kelas --</option>
                                <option value="Kelas 1">Kelas 1</option>
                                <option value="Kelas 2">Kelas 2</option>
                                <option value="Kelas 3">Kelas 3</option>
                                <option value="Kelas 4">Kelas 4</option>
                                <option value="Kelas 5">Kelas 5</option>
                            </select>
                        </div>

                        <!-- TEMPAT LAHIR -->
                        <div class="mb-3">
                            <label class="form-label fw-semibold">Tempat Lahir</label>
                            <input type="text" class="form-control" id="tempatLahir" placeholder="Kota lahir" required>
                        </div>

                        <!-- TANGGAL LAHIR -->
                        <div class="mb-4">
                            <label class="form-label fw-semibold">Tanggal Lahir</label>
                            <input type="date" class="form-control" id="tanggalLahir" required>
                        </div>

                        <hr>

                        <!-- WALI SECTION -->
                        <h6 class="fw-bold text-primary mb-3">Data Wali Santri</h6>

                        <!-- NAMA WALI -->
                        <div class="mb-3">
                            <label class="form-label fw-semibold">Nama Lengkap Wali</label>
                            <div class="input-group">
                                <span class="input-group-text">
                                    <i class="bi bi-person"></i>
                                </span>
                                <input type="text" class="form-control" id="namaWali" placeholder="Nama lengkap wali"
                                    required>
                            </div>
                        </div>

                        <!-- HUBUNGAN -->
                        <div class="mb-3">
                            <label class="form-label fw-semibold">Hubungan dengan Santri</label>
                            <select class="form-select" id="hubungan" required>
                                <option selected disabled>-- Pilih Hubungan --</option>
                                <option value="Ayah">Ayah</option>
                                <option value="Ibu">Ibu</option>
                                <option value="Wali">Wali</option>
                            </select>
                        </div>

                        <!-- NOMOR HP -->
                        <div class="mb-3">
                            <label class="form-label fw-semibold">Nomor HP Wali</label>
                            <div class="input-group">
                                <span class="input-group-text">
                                    <i class="bi bi-telephone"></i>
                                </span>
                                <input type="tel" class="form-control" id="nomorHp" placeholder="08xx xxxx xxxx"
                                    required>
                            </div>
                        </div>

                        <!-- ALAMAT -->
                        <div class="mb-4">
                            <label class="form-label fw-semibold">Alamat</label>
                            <textarea class="form-control" id="alamat" rows="3" placeholder="Alamat rumah wali"
                                required></textarea>
                        </div>

                        <!-- BUTTON -->
                        <div class="d-flex justify-content-between gap-2">
                            <button type="reset" class="btn btn-secondary flex-grow-1">
                                <i class="bi bi-arrow-clockwise me-1"></i> Reset
                            </button>
                            <button type="submit" class="btn btn-primary flex-grow-1">
                                <i class="bi bi-plus-circle me-1"></i> Tambah Data
                            </button>
                        </div>

                    </form>
                </div>
            </div>

            <!-- RIGHT SECTION - DATA DISPLAY -->
            <div class="col-lg-6">
                <div class="data-display-section">
                    <div class="p-3 border-bottom">
                        <h5 class="fw-bold mb-0">
                            <i class="bi bi-list-check me-2 text-primary"></i> Data Tersimpan
                        </h5>
                        <small class="text-muted">Total: <span id="totalData">0</span> data</small>
                    </div>

                    <div class="data-list-container" id="dataContainer">
                        <div class="empty-state">
                            <i class="bi bi-inbox"></i>
                            <p class="mb-0">Belum ada data</p>
                            <small class="text-muted">Isi form di sebelah kiri untuk menambah data</small>
                        </div>
                    </div>
                </div>
            </div>

        </div>

    </div>


    <!-- Bootstrap JS -->
    <script src="bootstrap/js/bootstrap.bundle.min.js"></script>

    <!-- MODAL - VIEW DETAIL -->
    <div class="modal fade" id="modalDetail" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title fw-bold">
                        <i class="bi bi-eye me-2"></i> Detail Data Santri
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="modalDetailContent">
                    <!-- Content will be filled by JS -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Tutup</button>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL - EDIT DATA -->
    <div class="modal fade" id="modalEdit" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title fw-bold">
                        <i class="bi bi-pencil-square me-2"></i> Edit Data Santri
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="formEdit">
                        <!-- DATA SANTRI -->
                        <h6 class="fw-bold text-primary mb-3">Data Santri</h6>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label fw-semibold">NIS</label>
                                <input type="text" class="form-control" id="editNis" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label fw-semibold">Nama Lengkap</label>
                                <input type="text" class="form-control" id="editNamaSantri" required>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label fw-semibold">Jenis Kelamin</label>
                                <select class="form-select" id="editJenisKelamin" required>
                                    <option value="Laki-laki">Laki-laki</option>
                                    <option value="Perempuan">Perempuan</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label fw-semibold">Kelas</label>
                                <select class="form-select" id="editKelas" required>
                                    <option value="Kelas 1">Kelas 1</option>
                                    <option value="Kelas 2">Kelas 2</option>
                                    <option value="Kelas 3">Kelas 3</option>
                                    <option value="Kelas 4">Kelas 4</option>
                                    <option value="Kelas 5">Kelas 5</option>
                                </select>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label fw-semibold">Tempat Lahir</label>
                                <input type="text" class="form-control" id="editTempatLahir" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label fw-semibold">Tanggal Lahir</label>
                                <input type="date" class="form-control" id="editTanggalLahir" required>
                            </div>
                        </div>

                        <hr>

                        <!-- DATA WALI -->
                        <h6 class="fw-bold text-primary mb-3">Data Wali Santri</h6>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label fw-semibold">Nama Wali</label>
                                <input type="text" class="form-control" id="editNamaWali" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label fw-semibold">Hubungan</label>
                                <select class="form-select" id="editHubungan" required>
                                    <option value="Ayah">Ayah</option>
                                    <option value="Ibu">Ibu</option>
                                    <option value="Wali">Wali</option>
                                </select>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label fw-semibold">Nomor HP</label>
                                <input type="tel" class="form-control" id="editNomorHp" required>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label fw-semibold">Alamat</label>
                            <textarea class="form-control" id="editAlamat" rows="3" required></textarea>
                        </div>

                        <input type="hidden" id="editIndex">
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                    <button type="button" class="btn btn-primary" id="btnSaveEdit">
                        <i class="bi bi-save me-1"></i> Simpan Perubahan
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL - DELETE CONFIRMATION -->
    <div class="modal fade" id="modalDelete" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title fw-bold">
                        <i class="bi bi-trash me-2"></i> Hapus Data
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                        aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p class="mb-0">
                        <strong>Apakah Anda yakin ingin menghapus data santri <span
                                id="deleteNameDisplay"></span>?</strong>
                    </p>
                    <small class="text-muted">Tindakan ini tidak dapat dibatalkan.</small>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                    <button type="button" class="btn btn-danger" id="btnConfirmDelete">
                        <i class="bi bi-trash me-1"></i> Hapus
                    </button>
                </div>
                <input type="hidden" id="deleteIndex">
            </div>
        </div>
    </div>

    <script>
        /* ===============================
           DATA MANAGEMENT
        ================================ */
        let dataList = JSON.parse(localStorage.getItem('dataSantri')) || [];
        let currentEditIndex = null;
        let currentDeleteIndex = null;

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            initSidebarToggle('btn-toggle', 'sidebar');
            renderDataList();
            setupFormHandlers();
        });

        /* ===============================
           SIDEBAR TOGGLE
        ================================ */
        function initSidebarToggle(buttonId, sidebarId, activeClass = 'active') {
            const button = document.getElementById(buttonId);
            const sidebar = document.getElementById(sidebarId);

            if (!button || !sidebar) return;

            button.addEventListener('click', () => {
                sidebar.classList.toggle(activeClass);
            });
        }

        /* ===============================
           FORM HANDLERS
        ================================ */
        function setupFormHandlers() {
            // Form Submit
            document.getElementById('formSantri').addEventListener('submit', (e) => {
                e.preventDefault();
                addData();
            });

            // Edit Save
            document.getElementById('btnSaveEdit').addEventListener('click', saveEditData);

            // Delete Confirm
            document.getElementById('btnConfirmDelete').addEventListener('click', confirmDelete);
        }

        function getFormData() {
            return {
                nis: document.getElementById('nis').value,
                namaSantri: document.getElementById('namaSantri').value,
                jenisKelamin: document.getElementById('jenisKelamin').value,
                kelas: document.getElementById('kelas').value,
                tempatLahir: document.getElementById('tempatLahir').value,
                tanggalLahir: document.getElementById('tanggalLahir').value,
                namaWali: document.getElementById('namaWali').value,
                hubungan: document.getElementById('hubungan').value,
                nomorHp: document.getElementById('nomorHp').value,
                alamat: document.getElementById('alamat').value
            };
        }

        function addData() {
            const data = getFormData();
            dataList.push(data);
            saveToStorage();
            renderDataList();
            document.getElementById('formSantri').reset();

            // Show success message
            showAlert('Data berhasil ditambahkan!', 'success');
        }

        function renderDataList() {
            const container = document.getElementById('dataContainer');
            const totalData = document.getElementById('totalData');

            totalData.textContent = dataList.length;

            if (dataList.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="bi bi-inbox"></i>
                        <p class="mb-0">Belum ada data</p>
                        <small class="text-muted">Isi form di sebelah kiri untuk menambah data</small>
                    </div>
                `;
                return;
            }

            container.innerHTML = dataList.map((data, index) => `
                <div class="data-item">
                    <div class="data-item-header">
                        <div>
                            <div class="data-item-title">${data.namaSantri}</div>
                            <div class="data-item-meta">NIS: ${data.nis} â€¢ ${data.kelas}</div>
                        </div>
                    </div>
                    <div class="data-item-actions">
                        <button class="btn btn-sm btn-outline-primary" onclick="viewDetail(${index})">
                            <i class="bi bi-eye"></i> Lihat
                        </button>
                        <button class="btn btn-sm btn-outline-warning" onclick="openEditModal(${index})">
                            <i class="bi bi-pencil"></i> Edit
                        </button>
                        <button class="btn btn-sm btn-outline-danger" onclick="openDeleteModal(${index})">
                            <i class="bi bi-trash"></i> Hapus
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function viewDetail(index) {
            const data = dataList[index];
            const content = `
                <div class="detail-row">
                    <div class="detail-label">Nama Santri</div>
                    <div class="detail-value">${data.namaSantri}</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">NIS</div>
                    <div class="detail-value">${data.nis}</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">Jenis Kelamin</div>
                    <div class="detail-value">${data.jenisKelamin}</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">Kelas</div>
                    <div class="detail-value">${data.kelas}</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">Tempat & Tanggal Lahir</div>
                    <div class="detail-value">${data.tempatLahir}, ${formatDate(data.tanggalLahir)}</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">Nama Wali</div>
                    <div class="detail-value">${data.namaWali}</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">Hubungan</div>
                    <div class="detail-value">${data.hubungan}</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">Nomor HP</div>
                    <div class="detail-value">${data.nomorHp}</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">Alamat</div>
                    <div class="detail-value">${data.alamat}</div>
                </div>
            `;

            document.getElementById('modalDetailContent').innerHTML = content;
            new bootstrap.Modal(document.getElementById('modalDetail')).show();
        }

        function openEditModal(index) {
            currentEditIndex = index;
            const data = dataList[index];

            document.getElementById('editNis').value = data.nis;
            document.getElementById('editNamaSantri').value = data.namaSantri;
            document.getElementById('editJenisKelamin').value = data.jenisKelamin;
            document.getElementById('editKelas').value = data.kelas;
            document.getElementById('editTempatLahir').value = data.tempatLahir;
            document.getElementById('editTanggalLahir').value = data.tanggalLahir;
            document.getElementById('editNamaWali').value = data.namaWali;
            document.getElementById('editHubungan').value = data.hubungan;
            document.getElementById('editNomorHp').value = data.nomorHp;
            document.getElementById('editAlamat').value = data.alamat;

            new bootstrap.Modal(document.getElementById('modalEdit')).show();
        }

        function saveEditData() {
            const updatedData = {
                nis: document.getElementById('editNis').value,
                namaSantri: document.getElementById('editNamaSantri').value,
                jenisKelamin: document.getElementById('editJenisKelamin').value,
                kelas: document.getElementById('editKelas').value,
                tempatLahir: document.getElementById('editTempatLahir').value,
                tanggalLahir: document.getElementById('editTanggalLahir').value,
                namaWali: document.getElementById('editNamaWali').value,
                hubungan: document.getElementById('editHubungan').value,
                nomorHp: document.getElementById('editNomorHp').value,
                alamat: document.getElementById('editAlamat').value
            };

            dataList[currentEditIndex] = updatedData;
            saveToStorage();
            renderDataList();
            bootstrap.Modal.getInstance(document.getElementById('modalEdit')).hide();
            showAlert('Data berhasil diperbarui!', 'success');
        }

        function openDeleteModal(index) {
            currentDeleteIndex = index;
            const data = dataList[index];
            document.getElementById('deleteNameDisplay').textContent = data.namaSantri;
            new bootstrap.Modal(document.getElementById('modalDelete')).show();
        }

        function confirmDelete() {
            dataList.splice(currentDeleteIndex, 1);
            saveToStorage();
            renderDataList();
            bootstrap.Modal.getInstance(document.getElementById('modalDelete')).hide();
            showAlert('Data berhasil dihapus!', 'info');
        }

        function saveToStorage() {
            localStorage.setItem('dataSantri', JSON.stringify(dataList));
        }

        function formatDate(dateString) {
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            return new Date(dateString).toLocaleDateString('id-ID', options);
        }

        function showAlert(message, type) {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type} alert-dismissible fade show`;
            alertDiv.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            `;

            const content = document.querySelector('.content');
            content.insertBefore(alertDiv, content.firstChild);

            setTimeout(() => {
                alertDiv.remove();
            }, 3000);
        }
    </script>

</body>

</html>